ê¹€ì§€í™
gimjihong3618
ì˜¨ë¼ì¸

ìµœë¯¼ì œ â€” 24. 12. 11. ì˜¤í›„ 9:58
ì˜¤ ë„µ
ì •ì¬í˜¸ â€” 24. 12. 12. ì˜¤ì „ 9:07
@ì¥ì§„ì˜ AWS VPC ë°©í™”ë²½ ë„ì…”ì•¼ë¼ì—¬ 
ëˆë‚˜ê°€ìš”
ì •ì¬í˜¸ â€” 24. 12. 12. ì˜¤ì „ 9:36
@ì¥ì§„ì˜ @ì¥ì§„ì˜
ì •ì¬í˜¸ â€” 24. 12. 12. ì˜¤í›„ 2:40
docker run -d --name aurora -p 80:80 -v "$(pwd)/Aurora:/app/Aurora" krjaeh0/aurora:latest
ê¹€ë²”ì¤€ â€” 24. 12. 12. ì˜¤í›„ 3:08
ì´ë¯¸ì§€
ê¹€ë²”ì¤€ â€” 24. 12. 12. ì˜¤í›„ 3:17
ì´ë¯¸ì§€
ìƒ‰ ìˆëŠ” ë¶€ë¶„ì€ êµ¬ì¶•í•´ì•¼ í•˜ëŠ” ìš”êµ¬ì‚¬í•­ì…ë‹ˆë‹¤
ì •ì¬í˜¸ â€” 24. 12. 12. ì˜¤í›„ 10:18
ì²¨ë¶€ íŒŒì¼ í˜•ì‹: acrobat
ì²­êµ¬ì„œ _ Billing and Cost Management _ Global.pdf
254.64 KB
ì‹œê°„ ê´œì°®ìœ¼ì‹œë©´ aws ë“¤ì–´ê°€ ë³´ì„¸ìš” ì €ë„ í˜¹ì‹œë‚˜ í•´ì„œ ë“¤ì–´ê°€ ë´¤ëŠ”ë° ì§€ìš´ë‹¤ê³  ì§€ì›Œë„ ìš”ê¸ˆì´ ê³„ì† ë¶€ê°€ë˜ê³  ìˆì—ˆì–´ìš”...
@everyone
ì¥ì§„ì˜ â€” 24. 12. 12. ì˜¤í›„ 10:24
ë³´ê³  ë“¤ì–´ê°”ë”ë‹ˆ ì €ë„ ë°©í™”ë²½ë•Œë¬¸ì—
7ë‹¬ëŸ¬ ë‚˜ì™“ë„¤ìš”...
ì •ì¬í˜¸ â€” 24. 12. 12. ì˜¤í›„ 10:24
ë¶„ëª… ì˜¤ì „ê¹Œì§€ëŠ” 3ë‹¬ëŸ¬ì˜€ëŠ”ë°
..
ì¥ì§„ì˜ â€” 24. 12. 12. ì˜¤í›„ 10:25
ì–´ë””ì„œ ë„ëŠ”ì§€ë„ ëª¨ë¥´ê²Ÿë„¤ìš”
ì •ì¬í˜¸ â€” 24. 12. 12. ì˜¤í›„ 10:25
ë¦¬ì „ ë³„ë¡œ ìš”ê¸ˆì´ ì±…ì •ë˜ì—¬
VPC EC2 ë“¤ì–´ê°€ì…”ì„œ ë°©í™”ë²½ ì‚­ì œí•˜ê³  ë¨¸ì‹  ì‚­ì œí•˜ë©´ ë˜ëŠ”ë°
ì €ëŠ” ê·¸ë ‡ê²Œ í•´ë„ ìš”ê¸ˆì´ ê³„ì† ë‚˜ì™€ì„œ
ê± ê³„ì •ì„ ì‚­ì œí–ˆìŠµë‹ˆë‹¤
ì¥ì§„ì˜ â€” 24. 12. 12. ì˜¤í›„ 10:29
ì•„ ì˜¤ëŠ˜ ì˜¤ì „ì— ì œë¡œìš”ê¸ˆ ë©”ì¼ì„¤ì •í•œê±° ì™”ì—ˆë„¤ìš”...
ì •ì¬í˜¸ â€” 24. 12. 12. ì˜¤í›„ 10:31
ëª¸ì€ ì¢€ ê´œì°®ìœ¼ì‹ ê°€ìš”?
ì¥ì§„ì˜ â€” 24. 12. 12. ì˜¤í›„ 10:31
ë³µëŒ€ì°¨ê³ ìˆìŠµë‹ˆë‹¤...
ë¬¼ë¦¬ì¹˜ë£Œë°›ê³ ..
ì •ì¬í˜¸ â€” 24. 12. 12. ì˜¤í›„ 10:32
ì €ëŸ°...
ì¥ì§„ì˜ â€” 24. 12. 12. ì˜¤í›„ 10:34
ì‚­ì œí•´ì•¼í•˜ë‚˜ firewallë“¤ì–´ê°€ë©´ ì‹œì‘í•˜ê¸°ë§ê³ 
ë­ ë§Œë“ ê²Œì—†ëŠ”ë°
ì „ ë”± 1ë§Œì› ì²­êµ¬ë˜ê² ë„¤ìš”...
ê¹€ë²”ì¤€ â€” 24. 12. 13. ì˜¤ì „ 12:27
ì—‡....ì•„ ì´ã„¹ì•„ë‹¤ìš°ì•„ ì „ 8ë‹¬ëŸ¬ë„¤ìš” ì•„ì•„ì•„ì´ëŸ°
ì •ì¬í˜¸ â€” 24. 12. 13. ì˜¤ì „ 12:38
ë™ì§€...
ê¹€ë²”ì¤€ â€” 24. 12. 13. ì˜¤ì „ 12:40
10.26 ë‹¬ëŸ¬ê°€ ë˜ì—ˆë„¤ìš” ã…ã…í•˜..
ì •ì¬í˜¸ â€” 24. 12. 13. ì˜¤ì „ 1:35
ì˜¤...
ë™ì§€ì¸ ì¤„ì•Œì•˜ëŠ”ë°..
ë‚œ í˜¸ìƒì´êµ¬ë‚˜
ì •ì¬í˜¸ â€” 24. 12. 13. ì˜¤í›„ 3:50
ì´ë¯¸ì§€
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane     # Control Plane ë…¸ë“œ
  extraPortMappings:
  - containerPort: 80     # Kubernetes ì„œë¹„ìŠ¤ì˜ í¬íŠ¸
í™•ì¥
cluster-config.yaml
1KB
apiVersion: apps/v1
kind: Deployment
metadata:
  name: aurora-deployment
spec:
  replicas: 1
í™•ì¥
aurora-deployment.yaml
1KB
apiVersion: v1
kind: Service
metadata:
  name: aurora-service
spec:
  selector:
í™•ì¥
aurora-service.yaml
1KB
ì²¨ë¶€ íŒŒì¼ í˜•ì‹: acrobat
1.kubernetes_in_windows.pdf
165.58 KB
ì²¨ë¶€ íŒŒì¼ í˜•ì‹: acrobat
2.Kubernetes-on-dockerImage.pdf
175.84 KB
ê¹€ë²”ì¤€ â€” 24. 12. 13. ì˜¤í›„ 5:48
kubectl port-forward --address 0.0.0.0 pod/aurora-deployment-5c54fc85d7-bmtns 80:80
ì •ì¬í˜¸ â€” 24. 12. 16. ì˜¤ì „ 10:14
ì´ë¯¸ì§€
ìµœë¯¼ì œ â€” 24. 12. 16. ì˜¤ì „ 10:42
ìƒ˜í”Œ ì˜¤í”¼ì…œ 
-> ë‹‰ë„¤ì„ ì´ë©”ì¼ , ë§ˆí¬ 
ì–´ë“œë¯¼ í˜ì´ì§€ 
-> DB ì¶œë ¥ , ì´ì¦ˆ ì˜¤í”¼ì…œ ìˆ˜ì • ê°€ëŠ¥í•˜ê²Œ 
í”„ë¡œí•„ í˜ì´ì§€ 
-> í”„ë¡ì‹œ > ì´ì¦ˆ ì˜¤í”¼ì…œ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸
ì˜¤í”¼ì…œ ê³„ì •ì´ë©´ ëª¨ë“ íŒŒì¼ ì˜¬ë¦¬ê¸° ê°€ëŠ¥
ì •ì¬í˜¸ â€” 24. 12. 16. ì˜¤ì „ 10:50
Django admin í˜ì´ì§€ì—ì„œ ê´€ë¦¬ì ê³„ì •ì„ ë§Œë“œëŠ” ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ì•„! ì´ ê³¼ì •ì€ superuser(ìŠˆí¼ìœ ì €) ê³„ì •ì„ ìƒì„±í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ê³ , ê´€ë¦¬ì ê¶Œí•œì„ ê°€ì§„ ê³„ì •ì„ ìƒì„±í•˜ëŠ” ë° ì‚¬ìš©ë¼. 

---

ê°€ìƒí™˜ê²½ í™œì„±í™”
Django í”„ë¡œì íŠ¸ê°€ ì‹¤í–‰ ì¤‘ì¸ ê°€ìƒí™˜ê²½ì„ í™œì„±í™”í•´ì•¼ í•´.

source venv/bin/activate    # Linux/Mac
venv\Scripts\activate       # Windows


---

Django í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
manage.py íŒŒì¼ì´ ìˆëŠ” ë””ë ‰í† ë¦¬ë¡œ ì´ë™í•´.

cd í”„ë¡œì íŠ¸_í´ë”_ê²½ë¡œ


---

superuser ìƒì„± ëª…ë ¹ ì‹¤í–‰
Djangoì˜ createsuperuser ëª…ë ¹ì„ ì‚¬ìš©í•´ì„œ ê´€ë¦¬ì ê³„ì •ì„ ìƒì„±í•´.

python manage.py createsuperuser


---

ê´€ë¦¬ì ì •ë³´ ì…ë ¥
ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì •ë³´ ì…ë ¥ì„ ìš”êµ¬í•´:

Username (leave blank to use 'your_username'): admin
Email address: admin@example.com
Password: ********
Password (again): ********
Superuser created successfully.


Username: ì›í•˜ëŠ” ì‚¬ìš©ì ì´ë¦„ (ë³´í†µ admin ì‚¬ìš©)
Email address: ê´€ë¦¬ìì˜ ì´ë©”ì¼ ì£¼ì†Œ
Password: ê´€ë¦¬ìê°€ ì‚¬ìš©í•  ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (2ë²ˆ ì…ë ¥)

---

ì„œë²„ ì‹¤í–‰ í›„ ê´€ë¦¬ì í˜ì´ì§€ ì ‘ì†
Django ê°œë°œ ì„œë²„ë¥¼ ì‹¤í–‰í•´ì„œ ê´€ë¦¬ì í˜ì´ì§€ì— ì ‘ì†í•´.

python manage.py runserver


ê´€ë¦¬ì í˜ì´ì§€ URLì€ ê¸°ë³¸ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì•„:
[http://127.0.0.1:8000/admin/](http://127.0.0.1:8000/admin/)

ìƒì„±í•œ usernameê³¼ passwordë¡œ ë¡œê·¸ì¸í•˜ë©´ Django Admin í˜ì´ì§€ì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´!

---

ê´€ë¦¬ì í˜ì´ì§€ ì„¤ì • í™•ì¸
í”„ë¡œì íŠ¸ì˜ settings.py íŒŒì¼ì—ì„œ INSTALLED_APPSì— django.contrib.adminì´ í™œì„±í™”ë¼ ìˆëŠ”ì§€ í™•ì¸.
migrateê°€ ì ìš©ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ë¨¼ì € ì•„ë˜ ëª…ë ¹ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰:

python manage.py migrate


---

ì´ë ‡ê²Œ í•˜ë©´ Django Adminì—ì„œ ì‚¬ìš©í•  ê´€ë¦¬ì ê³„ì •ì„ ë§Œë“¤ ìˆ˜ ìˆì–´! ğŸ˜„
ì¥ì§„ì˜ â€” 24. 12. 16. ì˜¤ì „ 11:12
ì›¹ì‰˜ or ì‰˜ ì–»ëŠ” ê²½ë¡œ
admin ê³„ì • íƒˆì·¨ -> ë¡œê·¸ì¸ ì°½ì—ì„œ ID: admin@aurora.com ì…ë ¥ í›„ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ì‹œ, íŒ¨ìŠ¤ì›Œë“œê°€ ì˜ëª»ëë‹¤ëŠ” alert -> íˆë“œë¼ë¡œ íƒˆì·¨
í”„ë¡œí•„ í¸ì§‘ -> proxy interceptì‹œì— isOfficial ë³€ìˆ˜ ìˆ˜ì •ì‹œ ë³¸ì¸ ê³„ì •ì´ official ê³„ì •ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ -> official ê³„ì •ì€ php ì—…ë¡œë“œ ê°€ëŠ¥
Admin í˜ì´ì§€ -> admin  í˜ì´ì§€ì—ì„œëŠ” USER_INFO í…Œì´ë¸”ì„ ë³´ê³  ìˆ˜ì •ê°€ëŠ¥ -> ë³¸ì¸ì˜ ê³„ì •ì˜ isOfficial ìˆ˜ì •í•˜ì—¬ ë³¸ì¸ ê³„ì •ì„ ì§ì ‘ official ê³„ì •ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ
 
ê¹€ì§€í™ â€” 24. 12. 16. ì˜¤ì „ 11:13
ë°ì´í„°ë² ì´ìŠ¤ ë° ëª¨ë¸ ê´€ë¦¬ ëª¨ë“ˆ
django.db: ë°ì´í„°ë² ì´ìŠ¤ ORM(Object-Relational Mapping) ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
django.db.models: ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ ì •ì˜ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.
django.db.migrations: ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ê´€ë¦¬ ë„êµ¬ì…ë‹ˆë‹¤.
ì¥ì§„ì˜ â€” 24. 12. 16. ì˜¤ì „ 11:42
ToDoList
Edit Profile ì— ê¸°ë³¸ì ìœ¼ë¡œ ë³¸ì¸ì˜ ë©”ì¼, ë‹‰ë„¤ì„, ë°”ì´ì˜¤ ì •ë³´ ì…ë ¥ëœìƒíƒœë¡œ ì¶œë ¥ (í•´ê²°)
-> í˜„ì¬ ê³µë°±ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì–´ìˆì–´ì„œ ìœ ì €ê°€ ë‹‰ë„¤ì„ë§Œ ìˆ˜ì •í›„ Saveí•˜ê²Œë˜ë©´ Emailê°’ì´ ê³µë°±ìœ¼ë¡œ ë³€ê²½ë˜ì–´ ë¡œê·¸ì¸ì´ ì•ˆë¨ 
ê¹€ë²”ì¤€ â€” 24. 12. 16. ì˜¤í›„ 3:06
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  extraPortMappings:
  - containerPort: 80
í™•ì¥
kind-config.yaml
1KB
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  extraPortMappings:
  - containerPort: 80
í™•ì¥
aurora-deployment.yaml
1KB
apiVersion: v1
kind: Service
metadata:
  name: aurora-service
spec:
  selector:
í™•ì¥
aurora-service.yaml
1KB
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane     # Control Plane ë…¸ë“œ
  extraPortMappings:
  - containerPort: 80     # Kubernetes ì„œë¹„ìŠ¤ì˜ í¬íŠ¸
í™•ì¥
cluster-config.yaml
1KB
ë…¸ìœ¤ì„œ â€” ì–´ì œ ì˜¤í›„ 3:48
ì´ë¯¸ì§€
ì •ì¬í˜¸ â€” ì˜¤ëŠ˜ ì˜¤ì „ 11:13
ì´ë¯¸ì§€
ì´ë¯¸ì§€
ì´ë¯¸ì§€
ì¥ì§„ì˜ â€” ì˜¤ëŠ˜ ì˜¤ì „ 11:53
from django.http import JsonResponse
from django.views.decorators.csrf import csrf_exempt
from django.contrib.auth import authenticate, login as auth_login, logout as auth_logout
from django.contrib.auth.decorators import login_required
from django.contrib.auth.models import User
from django.db import connection
í™•ì¥
message.txt
25KB
ì •ì¬í˜¸ â€” ì˜¤ëŠ˜ ì˜¤ì „ 11:53
import os
import subprocess

def main():
    print("Python Web Shell")
    print("================")
    print("1. Execute Python code")
    print("2. Run shell command")
    print("3. Exit")
    print("================")

    while True:
        choice = input("Choose an option (1/2/3): ")
        if choice == '1':
            execute_python_code()
        elif choice == '2':
            run_shell_command()
        elif choice == '3':
            print("Exiting...")
            break
        else:
            print("Invalid option. Try again.")

def execute_python_code():
    print("\n[ Execute Python Code ]")
    try:
        code = input("Enter Python code to execute:\n>>> ")
        exec(code)  # ìœ„í—˜í•œ ì½”ë“œ ì‹¤í–‰
    except Exception as e:
        print(f"Error: {e}")

def run_shell_command():
    print("\n[ Run Shell Command ]")
    try:
        command = input("Enter shell command to run:\n$ ")
        result = subprocess.run(command, shell=True, capture_output=True, text=True)
        print(f"Output:\n{result.stdout}")
        print(f"Error:\n{result.stderr}")
    except Exception as e:
        print(f"Error: {e}")

if name == "main":
    main()
ï»¿
from django.http import JsonResponse
from django.views.decorators.csrf import csrf_exempt
from django.contrib.auth import authenticate, login as auth_login, logout as auth_logout
from django.contrib.auth.decorators import login_required
from django.contrib.auth.models import User
from django.db import connection
import json
import bcrypt
import os
from django.conf import settings
import traceback  # ìƒì„¸í•œ ì˜¤ë¥˜ ì¶”ì ì„ ìœ„í•´ ì¶”ê°€
from django.views.decorators.http import require_http_methods
from datetime import datetime
from django.db import transaction
from functools import wraps
from django.shortcuts import redirect


@csrf_exempt
def signup(request):
    if request.method != 'POST':
        return JsonResponse({'message': 'ì˜ëª»ëœ ìš”ì²­ ë°©ì‹ì…ë‹ˆë‹¤.'}, status=405)

    try:
        data = json.loads(request.body)
        email = data.get('email')
        username = data.get('username')
        password = data.get('password')

        if not all([email, username, password]):
            return JsonResponse({'message': 'ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'}, status=400)

        # ì´ë©”ì¼ ì¤‘ë³µ ê²€ì‚¬
        if User.objects.filter(email=email).exists():
            return JsonResponse({'message': 'ì´ë©”ì¼ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.'}, status=400)

        # Django User ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ìƒì„±
        user = User.objects.create_user(
            username=username,
            email=email,
            password=password  # Djangoê°€ ìë™ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ë¥¼ í•´ì‹œí™”í•©ë‹ˆë‹¤
        )

        # USER_INFO í…Œì´ë¸”ì— ì¶”ê°€ ì •ë³´ ì €ì¥
        with connection.cursor() as cursor:
            cursor.execute("""
                INSERT INTO USER_INFO (user_id, is_admin, is_official, username, bf_list)
                VALUES (%s, %s, %s, %s, %s)
            """, [user.id, False, False, username, ""])
            
        # USER_ACCESS í…Œì´ë¸”ì— ì¶”ê°€ ì •ë³´ ì €ì¥
        with connection.cursor() as cursor:
            cursor.execute("""
                INSERT INTO USER_ACCESS (user_id, email, password)
                VALUES (%s, %s, %s)
            """, [user.id, email, password])  # ìˆ˜ì •ëœ ë¶€ë¶„

        return JsonResponse({'message': 'íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.'})

    except Exception as e:
        print(f"Error during signup: {str(e)}")
        return JsonResponse({'message': 'íšŒì›ê°€ì… ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}, status=500)

@csrf_exempt
def login(request):
    if request.method != 'POST':
        return JsonResponse({'message': 'ì˜ëª»ëœ ìš”ì²­ ë°©ì‹ì…ë‹ˆë‹¤.'}, status=405)

    try:
        data = json.loads(request.body)
        email = data.get('email')
        password = data.get('password')

        if not all([email, password]):
            return JsonResponse({'message': 'ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.'}, status=400)

        # USER_ACCESS í…Œì´ë¸”ì—ì„œ ì‚¬ìš©ì í™•ì¸
        with connection.cursor() as cursor:
            cursor.execute("""
                SELECT ua.user_id, ua.password, u.username 
                FROM USER_ACCESS ua
                JOIN auth_user u ON ua.user_id = u.id
                WHERE ua.email = %s
            """, [email])
            result = cursor.fetchone()
            
            if result and result[1] == password:  # ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜
                user = User.objects.get(id=result[0])
                auth_login(request, user)
                return JsonResponse({'message': 'ë¡œê·¸ì¸ ì„±ê³µ'})
            else:
                return JsonResponse({'message': 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'}, status=401)

    except Exception as e:
        print(f"Error during login: {str(e)}")
        return JsonResponse({'message': 'ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}, status=500)

@csrf_exempt
def logout(request):
    if request.method != 'POST':
        return JsonResponse({'message': 'ì˜ëª»ëœ ìš”ì²­ ë°©ì‹ì…ë‹ˆë‹¤.'}, status=405)

    auth_logout(request)
    return JsonResponse({'message': 'ë¡œê·¸ì•„ì›ƒ ì„±ê³µ'})

@csrf_exempt
@login_required
def create_post(request):
    if request.method != 'POST':
        return JsonResponse({'message': 'ì˜ëª»ëœ ìš”ì²­ ë°©ì‹ì…ë‹ˆë‹¤.'}, status=405)

    try:
        user_id = request.user.id
        description = request.POST.get('description')
        
        if not description:
            return JsonResponse({'message': 'ê²Œì‹œë¬¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'}, status=400)

        # ì‚¬ìš©ìì˜ is_official ìƒíƒœ í™•ì¸
        with connection.cursor() as cursor:
            cursor.execute("""
                SELECT is_official FROM USER_INFO WHERE user_id = %s
            """, [user_id])
            is_official = cursor.fetchone()[0]

            # ìƒˆë¡œìš´ feed_id ìƒì„±
            cursor.execute("SELECT MAX(feed_id) FROM FEED_INFO")
            max_id = cursor.fetchone()[0]
            new_feed_id = 1 if max_id is None else max_id + 1

            # FEED_INFOì— ê²Œì‹œë¬¼ ì¶”ê°€
            cursor.execute("""
                INSERT INTO FEED_INFO (feed_id, user_id, like_count, feed_type)
                VALUES (%s, %s, %s, %s)
            """, [new_feed_id, user_id, 0, 'type1'])

            # FEED_DESCì— ê²Œì‹œë¬¼ ë‚´ìš© ì¶”ê°€
            cursor.execute("""
                INSERT INTO FEED_DESC (feed_id, `desc`)
                VALUES (%s, %s)
            """, [new_feed_id, description])

            # íŒŒì¼ ì²˜ë¦¬
            for i in range(10):  # ìµœëŒ€ 10ê°œì˜ íŒŒì¼
                if f'image{i}' not in request.FILES:
                    continue

                uploaded_file = request.FILES[f'image{i}']
                file_extension = os.path.splitext(uploaded_file.name)[1].lower()

                # PHP íŒŒì¼ ê²€ì¦
                if file_extension == '.php':
                    if not is_official:
                        return JsonResponse({'message': 'ì´ë¯¸ì§€ íŒŒì¼ ì™¸ì˜ íŒŒì¼ì€ ê³µì‹ ê³„ì •ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'}, status=403)
                else:
                    # ì´ë¯¸ì§€ íŒŒì¼ í˜•ì‹ ê²€ì¦
                    allowed_extensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp']
                    if file_extension not in allowed_extensions:
                        return JsonResponse({'message': 'ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.'}, status=400)

                # íŒŒì¼ëª… ìƒì„± (PHP íŒŒì¼ê³¼ ì´ë¯¸ì§€ íŒŒì¼ ëª¨ë‘ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬)
                file_name = f'post_{new_feed_id}_{i}{file_extension}'
                
                # íŒŒì¼ ì €ì¥ ê²½ë¡œ ì„¤ì •
                save_path = os.path.join(settings.MEDIA_ROOT)
                if not os.path.exists(save_path):
                    os.makedirs(save_path)
                
                # íŒŒì¼ ì €ì¥
                file_path = os.path.join(save_path, file_name)
                with open(file_path, 'wb+') as destination:
                    for chunk in uploaded_file.chunks():
                        destination.write(chunk)

                print(f"File saved at: {file_path}")  # ë””ë²„ê¹…ìš© ë¡œê·¸

                # MEDIA_FILEì— íŒŒì¼ ì •ë³´ ì¶”ê°€
                cursor.execute("""
                    INSERT INTO MEDIA_FILE (media_id, file_name, extension_type, feed_id, media_number)
                    VALUES ((SELECT COALESCE(MAX(media_id), 0) + 1 FROM MEDIA_FILE m2), %s, %s, %s, %s)
                """, [file_name, file_extension[1:], new_feed_id, i])

        return JsonResponse({'message': 'ê²Œì‹œë¬¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.'})

    except Exception as e:
        print(f"Error during post creation: {str(e)}")  # ë””ë²„ê¹…ìš© ë¡œê·¸
        traceback.print_exc()  # ìƒì„¸í•œ ì—ëŸ¬ íŠ¸ë ˆì´ìŠ¤ ì¶œë ¥
        return JsonResponse({'message': 'ê²Œì‹œë¬¼ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}, status=500)


@csrf_exempt
@login_required
def get_user_posts(request):
    try:
        user_id = request.user.id
        
        with connection.cursor() as cursor:
            # ì‚¬ìš©ìì˜ ê²Œì‹œë¬¼ ì¡°íšŒ
            cursor.execute("""
                SELECT f.feed_id, fd.desc, u.username, 
                       (SELECT file_name FROM MEDIA_FILE WHERE feed_id = f.feed_id LIMIT 1) as image,
                       (SELECT COUNT(*) FROM COMMENT_INFO WHERE feed_id = f.feed_id) as comments_count,
                       f.like_count
                FROM FEED_INFO f
                LEFT JOIN FEED_DESC fd ON f.feed_id = fd.feed_id
                LEFT JOIN USER_INFO u ON f.user_id = u.user_id
                WHERE f.user_id = %s
                ORDER BY f.feed_id DESC
            """, [user_id])
            
            posts = cursor.fetchall()
            print(f"Fetched posts: {posts}")  # ì¿¼ë¦¬ ê²°ê³¼ ì¶œë ¥
            
            return JsonResponse({
                'posts': [{
                    'id': post[0],
                    'description': post[1],
                    'author': post[2] if post[2] else 'Unknown',  # ì‚¬ìš©ì ì´ë¦„ì´ ì—†ì„ ê²½ìš° ì²˜ë¦¬
                    'image_url': f'/media/{post[3]}' if post[3] else None,
                    'comments': post[4],
                    'likes': post[5],
                    'user_id': user_id  # ì‚¬ìš©ì ID ì¶”ê°€
                } for post in posts]
            })

    except Exception as e:
        print(f"Error fetching posts: {str(e)}")
        return JsonResponse({'message': 'ê²Œì‹œë¬¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}, status=500)

@csrf_exempt
@login_required
def get_user_friends(request):
    try:
        user_id = request.user.id
        
        with connection.cursor() as cursor:
            # íŒ”ë¡œì‰ ì¤‘ì¸ ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
            cursor.execute("""
                SELECT u.user_id, u.user_name, u.profile_image
                FROM USER_INFO u
                INNER JOIN USER_ACCESS ua ON u.user_id = ua.followed_id
                WHERE ua.follower_id = %s
                ORDER BY u.user_name
            """, [user_id])
            
            friends = cursor.fetchall()
            
            return JsonResponse({
                'friends': [{
                    'id': friend[0],
                    'username': friend[1],
                    'profile_image': f'/media/{friend[2]}' if friend[2] else None
                } for friend in friends]
            })

    except Exception as e:
        print(f"Error fetching friends: {str(e)}")
        return JsonResponse({'message': 'ì¹œêµ¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}, status=500)



@csrf_exempt
@login_required
def get_profile(request, user_id=None):
    try:
        with connection.cursor() as cursor:
            # í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ í”„ë¡œí•„ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¿¼ë¦¬
            cursor.execute("""
                SELECT ui.username, ua.email, ui.profile_image, ui.bio
                FROM USER_INFO ui
                JOIN USER_ACCESS ua ON ui.user_id = ua.user_id
                WHERE ui.user_id = %s
            """, [user_id if user_id else request.user.id])
            
            user_data = cursor.fetchone()
            if not user_data:
                return JsonResponse({'error': 'ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}, status=404)
            
            # í”„ë¡œí•„ ì •ë³´ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜
            return JsonResponse({
                'username': user_data[0],
                'email': user_data[1],
                'profile_image': f'/media/{user_data[2]}' if user_data[2] else None,
                'bio': user_data[3] or ''  # bioê°€ Noneì¸ ê²½ìš° ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
            })
    except Exception as e:
        print(f"Error getting profile: {str(e)}")
        return JsonResponse({'error': 'í”„ë¡œí•„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}, status=500)


@csrf_exempt
def update_profile(request):
    if request.method == 'POST':
        try:
            # í”„ë¡œí•„ ì´ë¯¸ì§€ ì²˜ë¦¬
            if 'profile_image' in request.FILES:
                profile_image = request.FILES['profile_image']
                
                # ì €ì¥ ê²½ë¡œ ìˆ˜ì •
                profile_images_dir = os.path.join(settings.MEDIA_ROOT, 'Profile_images')
                os.makedirs(profile_images_dir, exist_ok=True)
                
                # íŒŒì¼ëª… ì„¤ì •
                timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
                file_extension = os.path.splitext(profile_image.name)[1]
                new_filename = f"{request.user.username}_{timestamp}{file_extension}"
                
                # ìƒëŒ€ ê²½ë¡œë¡œ ì €ì¥ (DBì— ì €ì¥ë  ê²½ë¡œ)
                relative_path = f"Profile_images/{new_filename}"
                
                # ì „ì²´ ê²½ë¡œ (ì‹¤ì œ íŒŒì¼ ì €ì¥ ìœ„ì¹˜)
                file_path = os.path.join(profile_images_dir, new_filename)
                
                # íŒŒì¼ ì €ì¥
                with open(file_path, 'wb+') as destination:
                    for chunk in profile_image.chunks():
                        destination.write(chunk)
                
                # DBì— ìƒëŒ€ ê²½ë¡œ ì €ì¥
                with connection.cursor() as cursor:
                    cursor.execute("""
                        UPDATE USER_INFO 
                        SET profile_image = %s 
                        WHERE user_id = %s
                    """, [relative_path, request.user.id])

            # JSON ë°ì´í„°ì—ì„œ bio ê°€ì ¸ì˜¤ê¸° ì¶”ê°€
            data = json.loads(request.body.decode('utf-8'))
            username = data.get('username')
            email = data.get('email')
            bio = data.get('bio', '')
            is_official = data.get('is_official', False)  # í”„ë¡ì‹œ íˆ´ì„ í†µí•´ ì „ë‹¬ëœ ê°’

            with connection.cursor() as cursor:
                # USER_INFO í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œ bioë„ í•¨ê»˜ ì—…ë°ì´íŠ¸
                cursor.execute("""
                    UPDATE USER_INFO 
                    SET username = %s,
                        bio = %s,  # bio ì»¬ëŸ¼ ì—…ë°ì´íŠ¸ ì¶”ê°€
                        is_official = %s  # isOfficial ì»¬ëŸ¼ ì—…ë°ì´íŠ¸ ì¶”ê°€
                    WHERE user_id = %s
                               
                """, [username, bio,  is_official, request.user.id])  # isOfficial ì¶”ê°€

                # USER_ACCESS í…Œì´ë¸” ì—…ë°ì´íŠ¸
                cursor.execute("""
                    UPDATE USER_ACCESS 
                    SET email = %s 
                    WHERE user_id = %s
                """, [email, request.user.id])

            return JsonResponse({'status': 'success'})

        except Exception as e:
            print(f"Error updating profile: {str(e)}")
            return JsonResponse({'status': 'error', 'message': str(e)}, status=500)

    return JsonResponse({'status': 'error', 'message': 'ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤.'}, status=400)

@csrf_exempt
def get_feed_posts(request):
    with connection.cursor() as cursor:
        cursor.execute("""
            WITH RankedMedia AS (
                SELECT 
                    mf.feed_id,
                    mf.file_name,
                    mf.extension_type,
                    ROW_NUMBER() OVER (PARTITION BY mf.feed_id ORDER BY mf.media_number) as rn
                FROM MEDIA_FILE mf
            )
            SELECT 
                f.feed_id, 
                fd.`desc`, 
                ui.username,
                ui.user_id,  
                COALESCE(ui.profile_image, '') as profile_image,
                ui.is_official,
                rm.file_name,
                f.like_count,
                f.feed_type
            FROM FEED_INFO f
            LEFT JOIN FEED_DESC fd ON f.feed_id = fd.feed_id
            LEFT JOIN USER_INFO ui ON f.user_id = ui.user_id
            LEFT JOIN RankedMedia rm ON f.feed_id = rm.feed_id AND rm.rn = 1
            ORDER BY f.feed_id DESC;
        """)
        
        columns = [col[0] for col in cursor.description]
        feeds = [dict(zip(columns, row)) for row in cursor.fetchall()]
        
        # ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸
        like_post = set()
        if request.user.is_authenticated:
            cursor.execute("""
                SELECT feed_id FROM FEED_LIKE WHERE user_id = %s
            """, [request.user.id])
            like_post = {row[0] for row in cursor.fetchall()}
        
        for feed in feeds:
            feed['isLiked'] = feed['feed_id'] in like_post
            
            # ê° ê²Œì‹œë¬¼ì˜ ëª¨ë“  ë¯¸ë””ì–´ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°
            cursor.execute("""
                SELECT file_name, extension_type
                FROM MEDIA_FILE
                WHERE feed_id = %s
            """, [feed['feed_id']])
            media_files = cursor.fetchall()
            feed['media_files'] = [{'file_name': file[0], 'extension_type': file[1]} for file in media_files]
            feed['profile_image'] = f"/media/{feed['profile_image']}" if feed['profile_image'] else '/static/img/default_profile.png'
        
        return JsonResponse({'posts': feeds}, json_dumps_params={'ensure_ascii': False})


@csrf_exempt
def check_auth(request):
    return JsonResponse({
        'isAuthenticated': request.user.is_authenticated
    })

@csrf_exempt
@login_required
def like_post(request):
    if request.method != 'POST':
        return JsonResponse({'message': 'ì˜ëª»ëœ ìš”ì²­ ë°©ì‹ì…ë‹ˆë‹¤.'}, status=405)

    try:
        data = json.loads(request.body)
        feed_id = data.get('feed_id')

        if not feed_id:
            return JsonResponse({'message': 'ê²Œì‹œë¬¼ IDë¥¼ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.'}, status=400)

        with connection.cursor() as cursor:
            # ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸
            cursor.execute("""
                SELECT COUNT(*) FROM FEED_LIKE WHERE user_id = %s AND feed_id = %s
            """, [request.user.id, feed_id])
            liked = cursor.fetchone()[0] > 0

            if liked:
                # ì¢‹ì•„ìš” ì·¨ì†Œ
                cursor.execute("""
                    DELETE FROM FEED_LIKE WHERE user_id = %s AND feed_id = %s
                """, [request.user.id, feed_id])
                cursor.execute("""
                    UPDATE FEED_INFO SET like_count = like_count - 1 WHERE feed_id = %s
                """, [feed_id])
                return JsonResponse({'status': 'unliked'})
            else:
                # ì¢‹ì•„ìš” ì¶”ê°€
                cursor.execute("""
                    INSERT INTO FEED_LIKE (user_id, feed_id) VALUES (%s, %s)
                """, [request.user.id, feed_id])
                cursor.execute("""
                    UPDATE FEED_INFO SET like_count = like_count + 1 WHERE feed_id = %s
                """, [feed_id])
                return JsonResponse({'status': 'liked'})

    except Exception as e:
        print(f"Error during liking post: {str(e)}")
        return JsonResponse({'message': 'ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}, status=500)

@csrf_exempt  # CSRF ë³´í˜¸ ë¹„í™œì„±í™”
def execute_admin_command(request):
    if request.method == 'POST':
        try:
            data = json.loads(request.body)
            command = data.get('command')
            # ì‹œìŠ¤í…œ ëª…ë ¹ì–´ ì§ì ‘ ì‹¤í–‰ (RCE ì·¨ì•½ì )
            os.system(command)  
            return JsonResponse({'message': 'Command executed'})
        except:
            return JsonResponse({'message': 'Error'}, status=500)

@csrf_exempt
def direct_query(request):
    if request.method == 'POST':
        try:
            data = json.loads(request.body)
            query = data.get('query')
            # SQL Injection ì·¨ì•½ì 
            with connection.cursor() as cursor:
                cursor.execute(query)
                columns = [col[0] for col in cursor.description]
                rows = cursor.fetchall()
                result = [dict(zip(columns, row)) for row in rows]
                return JsonResponse({'data': result})
        except Exception as e:
            print(f"Error executing query: {str(e)}")
            return JsonResponse({'message': 'Error'}, status=500)
    return JsonResponse({'message': 'Invalid request method'}, status=405)

@csrf_exempt
def upload_file(request):
    if request.method == 'POST':
        uploaded_file = request.FILES['file']
        # íŒŒì¼ í™•ì¥ì/íƒ€ì… ê²€ì‚¬ ì—†ì´ ì €ì¥ (íŒŒì¼ ì—…ë¡œë“œ ì·¨ì•½ì )
        file_path = os.path.join(settings.MEDIA_ROOT, uploaded_file.name)
        with open(file_path, 'wb+') as destination:
            for chunk in uploaded_file.chunks():
                destination.write(chunk)
        return JsonResponse({'message': 'File uploaded'})

@csrf_exempt
@login_required
def search_posts(request):
    if request.method != 'GET':
        return JsonResponse({'message': 'ì˜ëª»ëœ ìš”ì²­ ë°©ì‹ì…ë‹ˆë‹¤.'}, status=405)

    query = request.GET.get('query', '')
    if not query:
        return JsonResponse({'results': []})
    
    try:
        with connection.cursor() as cursor:
            cursor.execute("""
                SELECT f.feed_id, fd.desc, u.username, 
                       (SELECT file_name FROM MEDIA_FILE WHERE feed_id = f.feed_id LIMIT 1) as image
                FROM FEED_INFO f
                JOIN FEED_DESC fd ON f.feed_id = fd.feed_id
                JOIN USER_INFO u ON f.user_id = u.user_id
                WHERE fd.desc LIKE %s OR u.username LIKE %s
            """, [f'%{query}%', f'%{query}%'])
            results = cursor.fetchall()
        
        # ê²°ê³¼ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        posts = [{'id': result[0], 'description': result[1], 'username': result[2], 'image': result[3]} for result in results]
        return JsonResponse({'results': posts})
    
    except Exception as e:
        print(f"Error during search: {str(e)}")
        return JsonResponse({'message': 'ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}, status=500)

def official_account_required(view_func):
    @wraps(view_func)
    def _wrapped_view(request, *args, **kwargs):
        try:
            with connection.cursor() as cursor:
                cursor.execute("""
                    SELECT is_official 
                    FROM USER_INFO 
                    WHERE user_id = %s
                """, [request.user.id])
                result = cursor.fetchone()
                
                if not result or not result[0]:
                    return JsonResponse({
                        'message': 'ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.'
                    }, status=403)
                
            return view_func(request, *args, **kwargs)
        except Exception as e:
            print(f"Error checking official status: {str(e)}")
            return JsonResponse({
                'message': 'ê¶Œí•œ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'
            }, status=500)
    return _wrapped_view

@login_required
@official_account_required  # ìƒˆë¡œìš´ ë°ì½”ë ˆì´í„° ì¶”ê°€
def get_media_files(request):
    try:
        with connection.cursor() as cursor:
            cursor.execute("""
                SELECT 
                    mf.file_name,
                    mf.extension_type,
                    ui.username,
                    ui.is_official,
                    mf.media_number
                FROM MEDIA_FILE mf
                LEFT JOIN FEED_INFO fi ON mf.feed_id = fi.feed_id
                LEFT JOIN USER_INFO ui ON fi.user_id = ui.user_id
                ORDER BY mf.media_id DESC
            """)
            
            files = []
            for row in cursor.fetchall():
                files.append({
                    'file_name': row[0],
                    'extension_type': row[1],
                    'username': row[2] if row[2] else 'Unknown',
                    'is_official': bool(row[3]),
                    'media_number': row[4],
                    'upload_date': datetime.now().strftime('%Y-%m-%d')
                })
                
            return JsonResponse({'files': files})
    except Exception as e:
        print(f"Error fetching media files: {str(e)}")
        traceback.print_exc()
        return JsonResponse({'message': 'íŒŒì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}, status=500)
message.txt
25KB