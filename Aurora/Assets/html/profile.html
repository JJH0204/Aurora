{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurora - 프로필</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <style>
        .profile-container {
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .profile-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin-right: 30px;
            object-fit: cover;
        }

        .profile-info {
            flex: 1;
        }

        .profile-info h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .profile-stats {
            display: flex;
            gap: 30px;
            margin-bottom: 15px;
        }

        .stat-item {
            font-size: 16px;
        }

        .stat-item strong {
            font-weight: bold;
        }

        .profile-bio {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }

        .profile-actions button {
            padding: 8px 20px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            margin-right: 10px;
        }

        .follow-btn {
            background-color: #333;
            color: white;
        }

        .edit-profile-btn {
            background-color: #eee;
            color: #333;
        }

        .content-tabs {
            display: flex;
            justify-content: center;
            border-bottom: 1px solid #eee;
            margin-bottom: 30px;
        }

        .tab {
            padding: 15px 30px;
            cursor: pointer;
            font-weight: bold;
            color: #666;
            border-bottom: 2px solid transparent;
        }

        .tab.active {
            color: #333;
            border-bottom-color: #333;
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .grid-item {
            aspect-ratio: 1;
            overflow: hidden;
            border-radius: 5px;
            cursor: pointer;
            position: relative;
        }

        .grid-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .grid-item:hover img {
            transform: scale(1.05);
        }

        .grid-item .overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .grid-item:hover .overlay {
            opacity: 1;
        }

        .overlay-stats {
            color: white;
            display: flex;
            gap: 20px;
        }

        .overlay-stats span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .friends-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .friend-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
            transition: transform 0.2s ease;
        }

        .friend-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .friend-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
        }

        .friend-info {
            flex: 1;
        }

        .friend-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .friend-username {
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <div class="header">
        <div class="search-container">
            <input type="text" class="form-control search" placeholder="Aurora">
            <img src="{% static 'img/search.png' %}" alt="Search">
        </div>
        <button class="login-btn" onclick="window.location.href='/login/'">login</button>
    </div>

    <!-- Side Menu -->
    <div class="side-menu">
        <button onclick="window.location.href='/'"><img src="{% static 'img/aurora_logo.png' %}" alt="Aurora Logo"></button>
        <button onclick="window.location.href='/post/'"><img src="{% static 'img/post.png' %}" alt="Post"></button>
        <button onclick="window.location.href='/profile/'"><img src="{% static 'img/people.png' %}" alt="Profile"></button>
        <button onclick="window.location.href='/save/'"><img src="{% static 'img/save.png' %}" alt="Save"></button>
    </div>

    <!-- Arrow Down -->
    <div class="arrow-down" style="cursor: pointer;">
        <img src="{% static 'img/arrow.png' %}" alt="Arrow Down" style="transition: transform 0.3s ease;">
    </div>

    <div class="container-fluid">
        <div class="main-content">
            <div class="profile-container">
                <div class="profile-header">
                    <img src="{% static 'img/default_profile.png' %}" alt="Profile Picture" class="profile-image">
                    <div class="profile-info">
                        <h1 id="username">사용자 이름</h1>
                        <div class="profile-stats">
                            <div class="stat-item">게시물 <strong id="posts-count">0</strong></div>
                            <div class="stat-item">팔로워 <strong id="followers-count">0</strong></div>
                            <div class="stat-item">팔로잉 <strong id="following-count">0</strong></div>
                        </div>
                        <p class="profile-bio" id="user-bio">사용자 소개가 표시됩니다.</p>
                        <div class="profile-actions">
                            <button class="edit-profile-btn" onclick="editProfile()">프로필 편집</button>
                        </div>
                    </div>
                </div>

                <div class="content-tabs">
                    <div class="tab active" onclick="switchTab('posts')">게시물</div>
                    <div class="tab" onclick="switchTab('friends')">친구</div>
                </div>

                <div id="posts-content" class="content-grid">
                    <!-- 게시물이 동적으로 추가됩니다 -->
                </div>

                <div id="friends-content" class="friends-list" style="display: none;">
                    <!-- 친구 목록이 동적으로 추가됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // 페이지 로드 시 사용자 정보 로드
        document.addEventListener('DOMContentLoaded', function() {
            loadUserProfile();
            loadUserPosts();
            loadUserFriends();
        });

        function loadUserProfile() {
            fetch('/api/profile')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('username').textContent = data.username;
                    document.getElementById('posts-count').textContent = data.posts_count;
                    document.getElementById('followers-count').textContent = data.followers_count;
                    document.getElementById('following-count').textContent = data.following_count;
                    document.getElementById('user-bio').textContent = data.bio || '소개가 없습니다.';
                    
                    if (data.profile_image) {
                        document.querySelector('.profile-image').src = data.profile_image;
                    }
                })
                .catch(error => {
                    console.error('Error loading profile:', error);
                });
        }

        function loadUserPosts() {
            fetch('/api/user-posts')
                .then(response => response.json())
                .then(data => {
                    const postsGrid = document.getElementById('posts-content');
                    postsGrid.innerHTML = '';

                    data.posts.forEach(post => {
                        const postElement = createPostElement(post);
                        postsGrid.appendChild(postElement);
                    });
                })
                .catch(error => {
                    console.error('Error loading posts:', error);
                });
        }

        function loadUserFriends() {
            fetch('/api/user-friends')
                .then(response => response.json())
                .then(data => {
                    const friendsList = document.getElementById('friends-content');
                    friendsList.innerHTML = '';

                    data.friends.forEach(friend => {
                        const friendElement = createFriendElement(friend);
                        friendsList.appendChild(friendElement);
                    });
                })
                .catch(error => {
                    console.error('Error loading friends:', error);
                });
        }

        function createPostElement(post) {
            const div = document.createElement('div');
            div.className = 'grid-item';
            div.innerHTML = `
                <img src="${post.image_url}" alt="Post">
                <div class="overlay">
                    <div class="overlay-stats">
                        <span>❤️ ${post.likes}</span>
                        <span>💬 ${post.comments}</span>
                    </div>
                </div>
            `;
            return div;
        }

        function createFriendElement(friend) {
            const div = document.createElement('div');
            div.className = 'friend-item';
            div.innerHTML = `
                <img src="${friend.profile_image || '{% static "img/default_profile.png" %}'}" alt="${friend.username}" class="friend-avatar">
                <div class="friend-info">
                    <div class="friend-name">${friend.username}</div>
                    <div class="friend-username">@${friend.username}</div>
                </div>
            `;
            return div;
        }

        function switchTab(tab) {
            const tabs = document.querySelectorAll('.tab');
            const postsContent = document.getElementById('posts-content');
            const friendsContent = document.getElementById('friends-content');

            tabs.forEach(t => t.classList.remove('active'));
            if (tab === 'posts') {
                document.querySelector('.tab:first-child').classList.add('active');
                postsContent.style.display = 'grid';
                friendsContent.style.display = 'none';
            } else {
                document.querySelector('.tab:last-child').classList.add('active');
                postsContent.style.display = 'none';
                friendsContent.style.display = 'grid';
            }
        }

        function editProfile() {
            // 프로필 편집 기능은 추후 구현
            alert('프로필 편집 기능은 준비 중입니다.');
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>